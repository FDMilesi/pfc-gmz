<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/template.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.EditTratamientoTitle}"></h:outputText>
        </ui:define>

        <ui:define name="body">
            <h:form>
                <p:breadCrumb>
                    <p:menuitem value="Home" url="../agenda/Agenda.xhtml" />
                    <p:menuitem value="Pacientes" url="../paciente/List.xhtml"  />
                    <p:menuitem value="Tratamientos de #{editTratamientoController.selected.paciente.toString()}" 
                                url="../tratamiento/List.xhtml?paciente=#{editTratamientoController.selected.paciente.id}"/>
                    <p:menuitem value="Editar tratamiento" disabled="true"/>
                </p:breadCrumb>
            </h:form>
            <h:form id="TratamientoEditForm">
                <h:panelGroup id="display" class="ui-fluid">
                    <p:panelGrid columns="4" layout="grid" columnClasses="ui-g-2, ui-g-4, ui-g-2, ui-g-4" rendered="#{!empty editTratamientoController.selected}">
                        <p:outputLabel value="#{bundle.TratamientoLabel_tipoDeTratamiento}" for="tipoTratamiento" />
                        <p:outputLabel value="#{editTratamientoController.selected.tipoDeTratamiento.toString()}" id="tipoTratamiento"/>

                        <p:outputLabel value="#{bundle.TratamientoLabel_particular}" for="particular" />
                        <p:outputLabel value="#{tratamientoController.selected.particular?'Si':'No'}" id="particular"/>

                        <p:outputLabel value="#{bundle.TratamientoLabel_diagnostico}" for="diagnostico" />
                        <p:inputText id="diagnostico" value="#{editTratamientoController.selected.diagnostico}" disabled="#{editTratamientoController.selected.finalizado}"/>

                        <p:outputLabel value="#{bundle.TratamientoLabel_finalizado}" for="finalizado" />
                        <p:selectBooleanCheckbox id="finalizado" value="#{editTratamientoController.selected.finalizado}" 
                                                 validator="#{editTratamientoController.validarFinalizacionTratamiento}"
                                                 disabled="#{editTratamientoController.selected.finalizado}"/>

                        <p:outputLabel value="#{bundle.TratamientoLabel_medicoDerivante}" for="medicoderivante" />
                        <p:inputText id="medicoderivante" value="#{editTratamientoController.selected.medicoDerivante}" />

                        <p:outputLabel value="#{bundle.TratamientoLabel_cantidadDeSesiones}" for="cantidadDeSesiones" />
                        <p:inputText id="cantidadDeSesiones" 
                                     value="#{editTratamientoController.selected.cantidadDeSesiones}" 
                                     validator="#{editTratamientoController.validarCantidadDeSesiones}" 
                                     disabled="#{editTratamientoController.selected.finalizado}"/>

                        <p:outputLabel value="#{bundle.TratamientoLabel_observaciones}" for="observaciones" />
                        <p:inputTextarea cols="22" rows="3" id="observaciones" value="#{editTratamientoController.selected.observaciones}" disabled="#{editTratamientoController.selected.finalizado}"/>

                        <h:panelGroup>
                            <p:commandButton actionListener="#{editTratamientoController.update}"
                                             value="#{bundle.Save}" 
                                             update="display,:growl,:OrdenTratamientoListForm,:SesionListForm" 
                                             disabled="#{empty editTratamientoController.selected || editTratamientoController.selected.finalizado}">
                                <f:setPropertyActionListener target="#{ordenMedicaController.tratamiento}" value="#{editTratamientoController.selected}" />
                                <f:setPropertyActionListener target="#{listSesionController.tratamientoEnEdicion}" value="#{editTratamientoController.selected}" />
                            </p:commandButton>
                            <p:button outcome="/protected/tratamiento/List.xhtml?paciente=#{editTratamientoController.selected.paciente.id}" value="#{bundle.Cancel}" disabled="#{empty editTratamientoController.selected || editTratamientoController.selected.finalizado}"/>
                        </h:panelGroup>
                    </p:panelGrid>
                </h:panelGroup>
            </h:form>
            <p:messages id="messages" />
            <ui:include src="ordenMedica/ListOrdenesTratamiento.xhtml" rendered="#{(not empty editTratamientoController.selected.paciente.obraSocial) 
                                                                                   and !editTratamientoController.selected.particular}"/>
            <ui:include src="ordenMedica/CreateOrdenMedica.xhtml" rendered="#{(not empty editTratamientoController.selected.paciente.obraSocial) 
                                                                              and !editTratamientoController.selected.particular}"/>
            <ui:include src="ordenMedica/AutorizarFromTratamiento.xhtml" rendered="#{(not empty editTratamientoController.selected.paciente.obraSocial) 
                                                                                     and !editTratamientoController.selected.particular}"/>
            <ui:include src="sesion/ListeSesionesTratamiento.xhtml" />
            <ui:include src="sesion/CreateSesionFromTratamiento.xhtml"/>
            <ui:include src="sesion/EditSesionFromTratamiento.xhtml"/>
        </ui:define>
    </ui:composition>
</html>
